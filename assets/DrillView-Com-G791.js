import{o as c,x as T,b as n,t as u,a as s,w as l,n as le,F as O,y as K,c as g,e as d,f as B,V,B as y,q as z,v as G,A as D,z as ae,r as p,h as se}from"./index-DhQRLbW3.js";import{u as oe}from"./settings-B_zFhrx1.js";import{V as q,R as ne}from"./RecorderPanel-CWV0VXwZ.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as L,a as U}from"./VRow-G4zAc8fo.js";import{V as A}from"./VCard-UVDnMe1Q.js";import{a as re,V as ue}from"./VList-CEntHrbq.js";import{V as j}from"./VChip-DdKD4VrS.js";import{V as ie}from"./VAlert-BrM09zbN.js";import{c as de,V as ce}from"./index-C1RnJIl4.js";import"./VOverlay-DC4qDW8R.js";import"./forwardRefs-BOMNi2Up.js";const ve=de("v-spacer","div","VSpacer"),me={class:"text-center mb-6"},fe={class:"text-body-2 text-medium-emphasis"},pe={class:"text-h5 font-weight-bold",style:{color:"#22d3ee"}},ge={class:"text-h5 font-weight-bold",style:{color:"#a78bfa"}},ye={class:"text-body-2 text-medium-emphasis mr-3"},be={class:"text-body-2"},xe={class:"text-caption"},ke={class:"text-body-2"},Se={class:"text-caption"},Ce={class:"d-flex gap-3"},Ve={__name:"SessionSummary",props:{sentences:{type:Array,default:()=>[]},language:{type:String,default:""},topic:{type:String,default:""},topics:{type:Array,default:()=>[]},stats:{type:Object,default:null}},emits:["new-session","go-home"],setup(E){const w=E,f=[{code:"de",nativeName:"Deutsch"},{code:"fr",nativeName:"Français"},{code:"es",nativeName:"Español"},{code:"en",nativeName:"English"}],I=y(()=>{var o;return((o=f.find(t=>t.code===w.language))==null?void 0:o.nativeName)||w.language}),x=y(()=>{var o;return((o=w.topics.find(t=>t.id===w.topic))==null?void 0:o.label)||w.topic}),r=y(()=>w.sentences.filter(o=>o.score!==null)),k=y(()=>r.value.length?Math.round(r.value.reduce((o,t)=>o+t.score,0)/r.value.length):null),v=y(()=>k.value!==null?`${k.value}%`:"—"),S=y(()=>k.value===null?"grey":k.value>=80?"#34d399":k.value>=55?"#fbbf24":"#f87171"),_=y(()=>{const o=r.value;return o.length?o.reduce((t,i)=>i.score>t.score?i:t):null}),C=y(()=>{const o=r.value;return o.length?o.reduce((t,i)=>i.score<t.score?i:t):null});function $(o){return o===null?"grey":o>=80?"success":o>=55?"warning":"error"}return(o,t)=>(c(),T("div",null,[n("div",me,[t[2]||(t[2]=n("div",{class:"text-h5 font-weight-bold mb-1",style:{color:"#22d3ee"}},"Session Complete!",-1)),n("div",fe,u(I.value)+" · "+u(x.value),1)]),s(U,{dense:"",class:"mb-6"},{default:l(()=>[s(L,{cols:"4"},{default:l(()=>[s(A,{class:"stat-card pa-3 text-center"},{default:l(()=>[n("div",{class:"text-h5 font-weight-bold",style:le({color:S.value})},u(v.value),5),t[3]||(t[3]=n("div",{class:"text-caption text-medium-emphasis"},"Avg Score",-1))]),_:1})]),_:1}),s(L,{cols:"4"},{default:l(()=>[s(A,{class:"stat-card pa-3 text-center"},{default:l(()=>[n("div",pe,u(E.sentences.length),1),t[4]||(t[4]=n("div",{class:"text-caption text-medium-emphasis"},"Sentences",-1))]),_:1})]),_:1}),s(L,{cols:"4"},{default:l(()=>[s(A,{class:"stat-card pa-3 text-center"},{default:l(()=>{var i,h;return[n("div",ge,u(((h=(i=E.stats)==null?void 0:i.stats)==null?void 0:h.streak_days)??"—"),1),t[5]||(t[5]=n("div",{class:"text-caption text-medium-emphasis"},"Day Streak",-1))]}),_:1})]),_:1})]),_:1}),t[11]||(t[11]=n("div",{class:"text-subtitle-2 text-medium-emphasis mb-3"},"RESULTS",-1)),s(ue,{lines:"one",class:"mb-6 rounded-lg","bg-color":"surface"},{default:l(()=>[(c(!0),T(O,null,K(E.sentences,(i,h)=>(c(),g(re,{key:h,subtitle:i.text},{prepend:l(()=>[n("span",ye,u(h+1),1)]),append:l(()=>[i.score!==null?(c(),g(j,{key:0,color:$(i.score),variant:"tonal",size:"small"},{default:l(()=>[d(u(i.score)+"%",1)]),_:2},1032,["color"])):(c(),g(j,{key:1,color:"grey",variant:"tonal",size:"small"},{default:l(()=>[...t[6]||(t[6]=[d("skipped",-1)])]),_:1}))]),_:2},1032,["subtitle"]))),128))]),_:1}),_.value||C.value?(c(),g(U,{key:0,dense:"",class:"mb-6"},{default:l(()=>[_.value?(c(),g(L,{key:0,cols:"6"},{default:l(()=>[s(A,{class:"pa-3",color:"success",variant:"tonal"},{default:l(()=>[t[7]||(t[7]=n("div",{class:"text-caption font-weight-bold mb-1"},"BEST",-1)),n("div",be,u(_.value.text),1),n("div",xe,u(_.value.score)+"%",1)]),_:1})]),_:1})):B("",!0),C.value?(c(),g(L,{key:1,cols:"6"},{default:l(()=>[s(A,{class:"pa-3",color:"error",variant:"tonal"},{default:l(()=>[t[8]||(t[8]=n("div",{class:"text-caption font-weight-bold mb-1"},"NEEDS WORK",-1)),n("div",ke,u(C.value.text),1),n("div",Se,u(C.value.score)+"%",1)]),_:1})]),_:1})):B("",!0)]),_:1})):B("",!0),n("div",Ce,[s(V,{variant:"tonal",flex:"1",class:"flex-1",onClick:t[0]||(t[0]=i=>o.$emit("go-home"))},{default:l(()=>[...t[9]||(t[9]=[d("Home",-1)])]),_:1}),s(V,{color:"primary",flex:"1",class:"flex-1",onClick:t[1]||(t[1]=i=>o.$emit("new-session"))},{default:l(()=>[...t[10]||(t[10]=[d("New Drill",-1)])]),_:1})])]))}},we=M(Ve,[["__scopeId","data-v-c587375d"]]),_e={class:"text-body-2 text-medium-emphasis mb-6"},$e={class:"text-body-2 font-weight-medium"},he={class:"d-flex align-center justify-space-between mb-3"},Ne={class:"text-body-2 text-medium-emphasis"},Ae={class:"text-h6 text-center mb-3",style:{"line-height":"1.6"}},De={key:0,class:"text-center mb-3"},Le={class:"d-flex gap-3 justify-center"},Te={class:"d-flex gap-3 mt-2"},Be={__name:"DrillView",setup(E){const w=se(),f=oe(),I=p([]),x=p(null),r=p([]),k=p(null),v=p(0),S=p("setup"),_=p(!1),C=p(""),$=p(!1),o=p(null),t=p(null),i=p(null),h=y(()=>{var a;return((a=f.LANGS.find(e=>e.code===f.language))==null?void 0:a.nativeName)||f.language}),N=y(()=>r.value[v.value]??null),W=y(()=>(v.value+1)/r.value.length*100);z.get("/api/drills/topics").then(a=>{I.value=a}).catch(()=>{});async function J(){_.value=!0,C.value="";try{const{sessionId:a,sentences:e}=await z.post("/api/drills/generate",{language:f.language,topic:x.value,model:f.model,count:f.drillCount});k.value=a,r.value=e.map(b=>({text:b,audio:null,score:null})),v.value=0,S.value="drill",F(0)}catch(a){C.value=a.message}finally{_.value=!1}}async function F(a){if(!r.value[a].audio){t.value=a;try{const e=await z.post("/api/drills/tts",{text:r.value[a].text,voice:f.voice,speed:f.ttsSpeed}),b=btoa(String.fromCharCode(...new Uint8Array(e)));r.value[a]={...r.value[a],audio:b},a+1<r.value.length&&F(a+1)}catch(e){console.error("TTS error",e)}finally{t.value===a&&(t.value=null)}}}async function Q(a){if(await F(a),!r.value[a].audio)return;o.value=a;const e=Uint8Array.from(atob(r.value[a].audio),P=>P.charCodeAt(0)),b=new AudioContext,R=await b.decodeAudioData(e.buffer),m=b.createBufferSource();m.buffer=R,m.connect(b.destination),m.start(),m.onended=()=>{o.value===a&&(o.value=null)}}function X(){var a;(a=N.value)!=null&&a.audio&&($.value=!0)}function Y(a){r.value[v.value]={...r.value[v.value],score:a},$.value=!1}function Z(a){return a===null?"grey":a>=80?"success":a>=55?"warning":"error"}async function H(){try{const a=await z.post("/api/drills/complete",{sessionId:k.value,sentences:r.value.map(e=>({text:e.text,score:e.score}))});i.value=a,S.value="summary"}catch(a){console.error("Complete error",a),S.value="summary"}}function ee(){H()}function te(){S.value="setup",r.value=[],k.value=null,x.value=null,v.value=0}return(a,e)=>(c(),g(ce,{class:"pa-4 pb-24",style:{"max-width":"640px"}},{default:l(()=>{var b,R;return[S.value==="setup"?(c(),T(O,{key:0},[e[7]||(e[7]=n("div",{class:"text-h6 font-weight-bold mb-1",style:{color:"#22d3ee"}},"Sentence Drills",-1)),n("div",_e,u(h.value)+" · "+u(G(f).drillCount)+" sentences ",1),e[8]||(e[8]=n("div",{class:"text-subtitle-2 text-medium-emphasis mb-3"},"CHOOSE A TOPIC",-1)),s(U,{dense:""},{default:l(()=>[(c(!0),T(O,null,K(I.value,m=>(c(),g(L,{key:m.id,cols:"6"},{default:l(()=>[s(A,{variant:x.value===m.id?"elevated":"tonal",color:x.value===m.id?"primary":void 0,class:"topic-card pa-3 cursor-pointer",onClick:P=>x.value=m.id},{default:l(()=>[n("div",$e,u(m.label),1)]),_:2},1032,["variant","color","onClick"])]),_:2},1024))),128))]),_:1}),s(V,{color:"primary",size:"large",block:"",class:"mt-6",loading:_.value,disabled:!x.value,onClick:J},{default:l(()=>[...e[6]||(e[6]=[d(" Generate Sentences ",-1)])]),_:1},8,["loading","disabled"]),C.value?(c(),g(ie,{key:0,type:"error",variant:"tonal",class:"mt-4",density:"compact"},{default:l(()=>[d(u(C.value),1)]),_:1})):B("",!0)],64)):S.value==="drill"?(c(),T(O,{key:1},[n("div",he,[n("div",Ne,u(v.value+1)+" / "+u(r.value.length),1),s(V,{icon:"",size:"small",variant:"text",onClick:ee},{default:l(()=>[s(D,null,{default:l(()=>[...e[9]||(e[9]=[d("mdi-close",-1)])]),_:1})]),_:1})]),s(ae,{"model-value":W.value,color:"primary",rounded:"",height:"4",class:"mb-6"},null,8,["model-value"]),s(A,{class:"pa-5 mb-4 sentence-card"},{default:l(()=>[n("div",Ae,u(N.value.text),1),N.value.score!==null?(c(),T("div",De,[s(j,{color:Z(N.value.score),variant:"tonal",size:"small"},{default:l(()=>[d(u(N.value.score)+"% ",1)]),_:1},8,["color"])])):B("",!0),n("div",Le,[s(V,{icon:"",variant:"tonal",color:o.value===v.value?"primary":void 0,loading:t.value===v.value,onClick:e[0]||(e[0]=m=>Q(v.value))},{default:l(()=>[s(D,null,{default:l(()=>[...e[10]||(e[10]=[d("mdi-volume-high",-1)])]),_:1}),s(q,{activator:"parent"},{default:l(()=>[...e[11]||(e[11]=[d("Listen",-1)])]),_:1})]),_:1},8,["color","loading"]),s(V,{icon:"",color:"secondary",variant:"tonal",disabled:!r.value[v.value].audio,onClick:X},{default:l(()=>[s(D,null,{default:l(()=>[...e[12]||(e[12]=[d("mdi-microphone",-1)])]),_:1}),s(q,{activator:"parent"},{default:l(()=>[...e[13]||(e[13]=[d("Repeat & compare",-1)])]),_:1})]),_:1},8,["disabled"])])]),_:1}),n("div",Te,[s(V,{variant:"tonal",disabled:v.value===0,onClick:e[1]||(e[1]=m=>v.value--)},{default:l(()=>[s(D,{start:""},{default:l(()=>[...e[14]||(e[14]=[d("mdi-chevron-left",-1)])]),_:1}),e[15]||(e[15]=d(" Back ",-1))]),_:1},8,["disabled"]),s(ve),v.value<r.value.length-1?(c(),g(V,{key:0,color:"primary",variant:"tonal",onClick:e[2]||(e[2]=m=>v.value++)},{default:l(()=>[e[17]||(e[17]=d(" Next ",-1)),s(D,{end:""},{default:l(()=>[...e[16]||(e[16]=[d("mdi-chevron-right",-1)])]),_:1})]),_:1})):(c(),g(V,{key:1,color:"primary",onClick:H},{default:l(()=>[e[19]||(e[19]=d(" Finish ",-1)),s(D,{end:""},{default:l(()=>[...e[18]||(e[18]=[d("mdi-check",-1)])]),_:1})]),_:1}))])],64)):S.value==="summary"?(c(),g(we,{key:2,sentences:r.value,language:G(f).language,topic:x.value,topics:I.value,stats:i.value,onNewSession:te,onGoHome:e[3]||(e[3]=m=>G(w).push("/"))},null,8,["sentences","language","topic","topics","stats"])):B("",!0),s(ne,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=m=>$.value=m),sentence:(b=N.value)==null?void 0:b.text,"native-audio-b64":(R=N.value)==null?void 0:R.audio,onAccept:Y,onClose:e[5]||(e[5]=m=>$.value=!1)},null,8,["modelValue","sentence","native-audio-b64"])]}),_:1}))}},Ke=M(Be,[["__scopeId","data-v-680fc81f"]]);export{Ke as default};
